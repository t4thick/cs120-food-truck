{% extends "staff_layout.html" %}
{% block staff_content %}

<div class="staff-page-header">
    <h1>Statistics & Analytics</h1>
    <p class="page-subtitle">Track orders, revenue, and customer activity</p>
</div>

<div class="stats-grid">
    <!-- Today's Stats -->
    <div class="stat-card primary">
        <div class="stat-icon">üìÖ</div>
        <div class="stat-content">
            <h3>Today</h3>
            <div class="stat-value">${{ "%.2f"|format(today_total) }}</div>
            <div class="stat-label">{{ today_count }} orders</div>
        </div>
    </div>

    <!-- This Month -->
    <div class="stat-card success">
        <div class="stat-icon">üìä</div>
        <div class="stat-content">
            <h3>This Month</h3>
            <div class="stat-value">${{ "%.2f"|format(month_total) }}</div>
            <div class="stat-label">{{ month_count }} orders</div>
        </div>
    </div>

    <!-- This Year -->
    <div class="stat-card info">
        <div class="stat-icon">üìà</div>
        <div class="stat-content">
            <h3>This Year</h3>
            <div class="stat-value">${{ "%.2f"|format(year_total) }}</div>
            <div class="stat-label">{{ year_count }} orders</div>
        </div>
    </div>

    <!-- Allergy Alerts -->
    <div class="stat-card warning">
        <div class="stat-icon">‚ö†Ô∏è</div>
        <div class="stat-content">
            <h3>Allergy Orders</h3>
            <div class="stat-value">{{ allergy_orders|length }}</div>
            <div class="stat-label">{{ unsafe_orders|length }} flagged unsafe</div>
        </div>
    </div>
</div>

<!-- Top Customers -->
<div class="stats-section">
    <h2>Top Customers</h2>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Email</th>
                    <th>Total Orders</th>
                </tr>
            </thead>
            <tbody>
                {% for email, count in top_customers %}
                <tr>
                    <td>#{{ loop.index }}</td>
                    <td>{{ email }}</td>
                    <td><strong>{{ count }}</strong> orders</td>
                </tr>
                {% endfor %}
                {% if top_customers|length == 0 %}
                <tr>
                    <td colspan="3" style="text-align: center; color: #666;">No customer data yet</td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Recent Orders -->
<div class="stats-section">
    <h2>Recent Orders</h2>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Items</th>
                    <th>Allergies</th>
                    <th>Time</th>
                </tr>
            </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr {% if order.is_safe == 'NO' %}style="background-color:#fff3cd;"{% endif %}>
                    <td>#{{ order.order_id }}</td>
                    <td>{{ order.customer_name }}</td>
                    <td>{{ order.item[:50] }}{% if order.item|length > 50 %}...{% endif %}</td>
                    <td>
                        {% if order.allergy_info %}
                            <span style="color: #dc3545; font-weight: bold;">‚ö†Ô∏è {{ order.allergy_info }}</span>
                        {% else %}
                            <span style="color: #28a745;">‚úì None</span>
                        {% endif %}
                    </td>
                    <td>{{ order.timestamp }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    display: flex;
    align-items: center;
    gap: 20px;
}

.stat-card.primary { border-left: 4px solid #007bff; }
.stat-card.success { border-left: 4px solid #28a745; }
.stat-card.info { border-left: 4px solid #17a2b8; }
.stat-card.warning { border-left: 4px solid #ffc107; }

.stat-icon {
    font-size: 48px;
}

.stat-content h3 {
    margin: 0 0 10px 0;
    color: #666;
    font-size: 14px;
    font-weight: 500;
}

.stat-value {
    font-size: 32px;
    font-weight: bold;
    color: #1a1a1a;
    margin-bottom: 5px;
}

.stat-label {
    color: #666;
    font-size: 14px;
}

.stats-section {
    background: white;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    margin-bottom: 20px;
}

.stats-section h2 {
    margin-top: 0;
    margin-bottom: 20px;
    color: #1a1a1a;
}

.table-wrapper {
    overflow-x: auto;
}

table {
    width: 100%;
    border-collapse: collapse;
}

table th {
    background: #f8f9fa;
    padding: 12px;
    text-align: left;
    font-weight: 600;
    color: #1a1a1a;
    border-bottom: 2px solid #dee2e6;
}

table td {
    padding: 12px;
    border-bottom: 1px solid #dee2e6;
}

table tr:hover {
    background: #f8f9fa;
}
</style>

{% endblock %}

